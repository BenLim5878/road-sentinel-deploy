<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/api/css/base.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"
        integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
    <title>SentinelVision</title>
    <link rel="icon" type="image/x-icon" href="/api/img/resource/app-icon.png">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
    <style>
        @keyframes fadeIn {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        * {
            padding: 0px;
            margin: 0px;
        }

        input[type="search"]::-webkit-search-decoration,
        input[type="search"]::-webkit-search-cancel-button,
        input[type="search"]::-webkit-search-results-button,
        input[type="search"]::-webkit-search-results-decoration {
            -webkit-appearance: none !important;
        }

        button {
            font-family: 'Inter';
        }

        input {
            background-color: #35353580 !important;
            color: white !important;
            border: 1px solid #9b9b9b4d !important;
        }

        input:focus {
            box-shadow: 0 0 0 0.25rem #389cfe30 !important;
        }

        label {
            color: #b7b7b7 !important;
        }

        .password-requirement-logo-green {
            background-image: url("/api/img/resource/green-tick.png");
            width: 28px;
            height: 28px;
            background-size: cover;
        }

        .password-requirement-logo-red {
            background-image: url("/api/img/resource/red-cross.png");
            width: 28px;
            height: 28px;
            background-size: cover;
        }

        .password-requirement-label-activated {
            color: #e0e0e0;
            font-family: 'Inter';
            font-style: normal;
            font-weight: 400;
            font-size: 16px;
        }

        .password-requirement-label-deactivated {
            color: #969696;
            font-family: 'Inter';
            font-style: normal;
            font-weight: 400;
            font-size: 16px;
        }

        .password-requirement-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
    </style>
</head>

<body class="bg-dark">
    <header class="py-3 px-5 bg-dark d-flex flex-row justify-content-between align-items-center"
        style="margin-bottom: 1px;outline: 1px solid rgba(255, 255, 255, 0.685);">
        <button class="d-flex flex-row align-items-center" style="gap: 10px;background-color:transparent"
            onclick="window.location.href='/app/'">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 85 85" fill="none">
                <circle cx="42.5" cy="42.5" r="42.5" fill="#E8F3F1" />
                <g clip-path="url(#clip0_1_9)">
                    <path
                        d="M43.12 47.66C42.44 48.21 42 49.05 42 50V61H56C58.2 61 60 59.2 60 57V45.05C58.11 44.38 56.09 44 54 44C49.95 44 46.13 45.4 43.12 47.66Z"
                        fill="#364B44" />
                    <path
                        d="M54 41C59.5228 41 64 36.5228 64 31C64 25.4772 59.5228 21 54 21C48.4772 21 44 25.4772 44 31C44 36.5228 48.4772 41 54 41Z"
                        fill="#00FFD0" />
                    <path
                        d="M41 31C41 28.83 41.54 26.8 42.47 25H28C25.8 25 24 26.8 24 29V57C24 58.1 24.45 59.1 25.18 59.83L44.81 40.2C42.46 37.84 41 34.59 41 31Z"
                        fill="#009BFB" />
                </g>
                <defs>
                    <clipPath id="clip0_1_9">
                        <rect width="48" height="48" fill="white" transform="translate(18 19)" />
                    </clipPath>
                </defs>
            </svg>
            <h4 style="font-family: Poppins;font-weight: 400;color: #ffffff">SentinelVision</h3>
        </button>
        <div>
            <button class="btn btn-light" onclick="window.location.href='/app/'">
                Maps
            </button>
            <button class="btn btn-success" onclick="window.location.href='/app/dashboard/'">
                Dashboard
            </button>
            <button class="btn btn-danger" onclick="window.location.href='/app/logout'">
                <i class="bi bi-door-open-fill"></i>
            </button>
        </div>
    </header>
    <section class="d-flex flex-row justify-content-between" style="width: 100%;height: 92vh">
        <div class="p-5" style="margin: 4% auto;">
            <h3 class="text-light mb-7" style="font-weight: 500">Create Users</h3>
            <div class="card mb-4" style="border:none; background: transparent;width: 1000px">
                <section class="d-flex flex-row justify-content-between" style="width: 100%;gap: 25px">
                    <div style="width: 500px;">
                        <div class="card-body pt-0 px-10">
                            <form class="d-flex flex-column" style="gap: 15px">
                                <div class="d-flex flex-column" style="gap: 10px">
                                    <label for="firstname">First Name</label>
                                    <input type="text" class="form-control" id="firstName" name="firstname"
                                        autocomplete="false">
                                </div>
                                <div class="d-flex flex-column" style="gap: 10px">
                                    <label for="lastname">Last Name</label>
                                    <input type="text" class="form-control" id="lastName" name="lastname">
                                </div>
                                <div class="d-flex flex-column" style="gap: 10px">
                                    <label for="Email1">Email address</label>
                                    <input type="email" class="form-control" id="email" aria-describedby="emailHelp"
                                        name="email">
                                </div>
                                <div class="d-flex flex-column align-items-end" style="gap: 10px">
                                    <div class="d-flex flex-column" style="width: 100%;gap:10px">
                                        <label for="Password">Password</label>
                                        <input type="password" class="form-control" id="password" name="password">
                                    </div>
                                </div>
                                <div class="d-flex flex-column" style="gap: 10px">
                                    <label for="ConfirmPassword">Confirm Password</label>
                                    <input type="password" class="form-control" id="confirmPassword"
                                        name="confirmPassword">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value=""
                                            id="showPasswordCheckbox">
                                        <label class="form-check-label" for="showPasswordCheckbox">
                                            Show Password
                                        </label>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="my-5 d-flex flex-row justify-content-end px-5">
                            <button id="create-user-button" class="btn btn-outline-success" disabled
                                style="width: 150px" onclick="createUser()">Create</button>
                        </div>
                    </div>
                    <div style="width: 500px">
                        <div class="password-requirement-container">
                            <div class="d-flex flex-row align-items-center" style="gap: 12px">
                                <div id="password-requirement-logo-1" class="password-requirement-logo-red"></div>
                                <h5 id="password-requirement-label-1" class="password-requirement-label-deactivated">
                                    Password must more than 8 characters</h5>
                            </div>
                            <div class="d-flex flex-row align-items-center" style="gap: 12px">
                                <div id="password-requirement-logo-2" class="password-requirement-logo-red"></div>
                                <h5 id="password-requirement-label-2" class="password-requirement-label-deactivated">
                                    Password must includes special characters</h5>
                            </div>
                            <div class="d-flex flex-row align-items-center" style="gap: 12px">
                                <div id="password-requirement-logo-3" class="password-requirement-logo-red"></div>
                                <h5 id="password-requirement-label-3" class="password-requirement-label-deactivated">
                                    Password must not contain email address</h5>
                            </div>
                            <div class="d-flex flex-row align-items-center" style="gap: 12px">
                                <div id="password-requirement-logo-4" class="password-requirement-logo-red"></div>
                                <h5 id="password-requirement-label-4" class="password-requirement-label-deactivated">
                                    Password must be same as confirm password</h5>
                            </div>
                        </div>
                    </div>
                </section>


            </div>
        </div>
        <section class=" d-flex flex-column p-5"
            style="width: 300px;gap: 10px;border-left: 1px solid rgba(255, 255, 255, 0.397)">
            <button class="btn btn-outline-secondary" onclick="window.location.href='/app/dashboard/'">
                Statistics
            </button>
            <button class="btn btn-primary" onclick="window.location.href='/app/user/'">
                Create Users
            </button>
            <button class="btn btn-outline-secondary" onclick="window.location.href='/app/setting/'">
                Settings
            </button>
        </section>
    </section>
    <div id="register-success-message" class="bg-success px-4 py-3 rounded align-items-center"
        style="box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);position:fixed; top: 11%; left: 50%;transform: translate(-50%, 0%); gap: 10px; display: none">
        <i class="bi bi-check-circle-fill text-light text-sm"></i>
        <p class="text-light" style="font-size: 15px;">Account Registered Successfully!</p>
    </div>
    <div id="register-failure-message" class="bg-danger px-4 py-3 rounded align-items-center"
        style="box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);position:fixed; top: 11%; left: 50%;transform: translate(-50%, 0%); gap: 10px; display: none">
        <i class="bi bi-dash-circle-fill text-light text-sm"></i>
        <p class="text-light" style="font-size: 15px;" id="failure-message"></p>
    </div>
    <script>
        // Get the query string from the current URL
        const queryString = window.location.search;

        // Create a URLSearchParams object to parse the query string
        const params = new URLSearchParams(queryString);

        if (params.has('isSuccess') && params.get('isSuccess') === 'true') {
            $("#register-success-message").css("display", "flex")
            $("#register-success-message").css("animation", "fadeIn 0.5s forwards")
            setTimeout(() => {
                $("#register-success-message").css("display", "none")
            }, 5000)
        }

        if (params.has('isError')) {
            $("#register-failure-message").css("display", "flex")
            $("#register-failure-message").css("animation", "fadeIn 0.5s forwards")
            $('#failure-message').html(params.get('isError'))
            setTimeout(() => {
                $("#register-failure-message").css("display", "none")
            }, 5000)
        }

        if (window.location.search.includes('isSuccess=true')) {
            // Remove the 'logout' parameter from the URL without reloading
            const newURL = window.location.href.replace('?isSuccess=true', '');
            window.history.replaceState({}, document.title, newURL);
        }

        if (window.location.search.includes('isError=')) {
            const newURL = window.location.href.replace(/[\?&]isError=[^&]+/, '');
            window.history.replaceState({}, document.title, newURL);
        }

        function createUser() {
            const password = $("#confirmPassword").val();
            const firstName = $('#firstName').val().toLowerCase();
            const lastName = $("#lastName").val().toLowerCase();
            const email = $("#email").val().toLowerCase();

            $.ajax({
                url: '/api/user',
                type: 'POST',
                contentType: "application/json",
                data: JSON.stringify({
                    "firstName": firstName,
                    "lastName": lastName,
                    "email": email,
                    "password": password
                }),
                success: function (response) {
                    window.location.href = "/app/user?isSuccess=true"
                },
                error: function (response) {
                    window.location.href = `/app/user?isError=${encodeURIComponent(response.responseText)}`
                }
            });
        }


        var passwordRequirements = [false, false, false, false]

        $(document).ready(() => {
            $(':input').attr('autocomplete', 'nope');
        })

        $('#firstName, #lastName, #email, #password, #confirmPassword').on("keyup", () => {
            var isPasswordValid = passwordRequirements.every(element => element);
            var isFirstNameValid = $("#firstName").val().trim().length > 0;
            var isLastNameValid = $("#lastName").val().trim().length > 0;
            var isEmailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test($('#email').val());

            if (isPasswordValid && isFirstNameValid && isLastNameValid && isEmailValid) {
                $("#create-user-button").prop('disabled', false)
            } else {
                $("#create-user-button").prop('disabled', true)
            }
        })

        $("#showPasswordCheckbox").change(function () {
            if ($(this).is(":checked")) {
                $("#password").attr("type", "text");
                $("#confirmPassword").attr("type", "text");
            } else {
                $("#password").attr("type", "password");
                $("#confirmPassword").attr("type", "password");
            }
        })

        $('#password').on('input', () => {
            var inputString = $('#password').val();

            // Checking the length requirement of the password
            if (inputString.length > 8) {
                $('#password-requirement-label-1').attr('class', 'password-requirement-label-activated')
                $('#password-requirement-logo-1').attr('class', 'password-requirement-logo-green')
                passwordRequirements[0] = true
            } else {
                $('#password-requirement-label-1').attr('class', 'password-requirement-label-deactivated')
                $('#password-requirement-logo-1').attr('class', 'password-requirement-logo-red')
                passwordRequirements[0] = false
            }

            // Checking the special character requirement of the password
            if (/[ `!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~]/.test(inputString)) {
                $('#password-requirement-label-2').attr('class', 'password-requirement-label-activated')
                $('#password-requirement-logo-2').attr('class', 'password-requirement-logo-green')
                passwordRequirements[1] = true
            } else {
                $('#password-requirement-label-2').attr('class', 'password-requirement-label-deactivated')
                $('#password-requirement-logo-2').attr('class', 'password-requirement-logo-red')
                passwordRequirements[1] = false
            }

            // Checking the email address requirement of the password
            if (/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(inputString)) {
                $('#password-requirement-label-3').attr('class', 'password-requirement-label-deactivated')
                $('#password-requirement-logo-3').attr('class', 'password-requirement-logo-red')
                passwordRequirements[2] = false
            } else {
                $('#password-requirement-label-3').attr('class', 'password-requirement-label-activated')
                $('#password-requirement-logo-3').attr('class', 'password-requirement-logo-green')
                passwordRequirements[2] = true
            }

            // Checking the same password requirement of the password
            if ($('#confirmPassword').val() != inputString) {
                $('#password-requirement-label-4').attr('class', 'password-requirement-label-deactivated')
                $('#password-requirement-logo-4').attr('class', 'password-requirement-logo-red')
                passwordRequirements[3] = false
            } else {
                $('#password-requirement-label-4').attr('class', 'password-requirement-label-activated')
                $('#password-requirement-logo-4').attr('class', 'password-requirement-logo-green')
                passwordRequirements[3] = true
            }
        }
        )

        $('#confirmPassword').on('input', () => {
            if ($('#confirmPassword').val() != $('#password').val()) {
                $('#password-requirement-label-4').attr('class', 'password-requirement-label-deactivated')
                $('#password-requirement-logo-4').attr('class', 'password-requirement-logo-red')
                passwordRequirements[3] = false
            } else {
                $('#password-requirement-label-4').attr('class', 'password-requirement-label-activated')
                $('#password-requirement-logo-4').attr('class', 'password-requirement-logo-green')
                passwordRequirements[3] = true
            }
        })
    </script>
</body>

</html>