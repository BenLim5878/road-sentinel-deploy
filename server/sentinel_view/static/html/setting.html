<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/api/css/base.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"
        integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
    <title>SentinelVision</title>
    <link rel="icon" type="image/x-icon" href="/api/img/resource/app-icon.png">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
</head>

<body class="bg-dark">
    <header class="py-3 px-5 bg-dark d-flex flex-row justify-content-between align-items-center"
        style="margin-bottom: 1px;outline: 1px solid rgba(255, 255, 255, 0.685);">
        <button class="d-flex flex-row align-items-center" style="gap: 10px;background-color:transparent"
            onclick="window.location.href='/app/'">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 85 85" fill="none">
                <circle cx="42.5" cy="42.5" r="42.5" fill="#E8F3F1" />
                <g clip-path="url(#clip0_1_9)">
                    <path
                        d="M43.12 47.66C42.44 48.21 42 49.05 42 50V61H56C58.2 61 60 59.2 60 57V45.05C58.11 44.38 56.09 44 54 44C49.95 44 46.13 45.4 43.12 47.66Z"
                        fill="#364B44" />
                    <path
                        d="M54 41C59.5228 41 64 36.5228 64 31C64 25.4772 59.5228 21 54 21C48.4772 21 44 25.4772 44 31C44 36.5228 48.4772 41 54 41Z"
                        fill="#00FFD0" />
                    <path
                        d="M41 31C41 28.83 41.54 26.8 42.47 25H28C25.8 25 24 26.8 24 29V57C24 58.1 24.45 59.1 25.18 59.83L44.81 40.2C42.46 37.84 41 34.59 41 31Z"
                        fill="#009BFB" />
                </g>
                <defs>
                    <clipPath id="clip0_1_9">
                        <rect width="48" height="48" fill="white" transform="translate(18 19)" />
                    </clipPath>
                </defs>
            </svg>
            <h4 style="font-family: Poppins;font-weight: 400;color: #ffffff">SentinelVision</h3>
        </button>
        <div>
            <button class="btn btn-light" onclick="window.location.href='/app/'">
                Maps
            </button>
            <button class="btn btn-success" onclick="window.location.href='/app/dashboard/'">
                Dashboard
            </button>
            <button class="btn btn-danger" onclick="window.location.href='/app/logout'">
                <i class="bi bi-door-open-fill"></i>
            </button>
        </div>
    </header>
    <section class="d-flex flex-row justify-content-between" style="width: 100%;height: 92vh">
        <div class="p-5" style="width: 1450px;margin: 0px auto;">
            <h3 class="text-light mb-7" style="font-weight: 500">System Configuration</h3>
            <div class="card mb-4" style="background-color: #232430;border:none">
                <div class="card-header pt-7" style="border-bottom: none">
                    <h4 class="text-light" style="font-weight: 500;">Image Processing</h4>
                    <p class="setting-description">Settings with image processing from user uploaded image in the server
                    </p>
                    <div class="mt-3" style="width: 100%; height:1px; background-color: gray"></div>
                </div>
                <div class="card-body pt-0 px-10">
                    <form>
                        <div class="form-group d-flex flex-row justify-content-between align-items-center">
                            <div>
                                <p class="text-white">Image Process Threshold</p>
                                <p class="setting-description" style="font-weight: 300;">Specify the amount of image the
                                    server will process in
                                    detection
                                    operation</p>
                            </div>
                            <div class="input-group" style="width: 15%;">
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-danger"
                                        style="border-radius: 0.375rem 0rem 0rem 0.375rem"
                                        id="decreaseBtn-image-threshold">-</button>
                                </span>
                                <input type="number" disabled class="form-control text-light text-center"
                                    style="background-color: #313131cc; border: 1px solid #4d4d4d"
                                    id="image-threshold-input" value="0" min="1" max="100">
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-success" id="increaseBtn-image-threshold"
                                        style="border-radius: 0rem 0.375rem 0.375rem 0rem">+</button>
                                </span>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="card-header pt-0" style="border-bottom: none">
                    <h4 class="text-light" style="font-weight: 500;">Mapping</h4>
                    <p class="setting-description">Settings with presenting potholes from Google Maps API
                    </p>
                    <div class="mt-3" style="width: 100%; height:1px; background-color: gray"></div>
                </div>
                <div class="card-body pt-0 px-10">
                    <form class="d-flex flex-column" style="gap: 30px;">
                        <div class="form-group d-flex flex-row justify-content-between align-items-center">
                            <div>
                                <p class="text-white">Minimum Zoom Level</p>
                                <p class="setting-description" style="font-weight: 300;">Specify the minimum amount of
                                    zoom level on Google Maps (0-22 levels) (Default is 6)</p>
                                <p class="text-danger" style="position: absolute;margin-top: 1px;display: none"
                                    id="minimum-zoom-level-warning-text">
                                    Minimum zoom
                                    level must not exceed maximum zoom
                                    level and must below or equals to initial zoom level !
                                </p>
                            </div>
                            <div class="input-group" style="width: 15%;">
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-danger"
                                        style="border-radius: 0.375rem 0rem 0rem 0.375rem"
                                        id="decreaseBtn-min-zoom-level">-</button>
                                </span>
                                <input type="number" disabled class="form-control text-light text-center"
                                    style="background-color: #313131cc; border: 1px solid #4d4d4d"
                                    id="minimum-zoom-level-input" value="0" min="0" max="22">
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-success" id="increaseBtn-min-zoom-level"
                                        style="border-radius: 0rem 0.375rem 0.375rem 0rem">+</button>
                                </span>
                            </div>
                        </div>
                        <div class="form-group d-flex flex-row justify-content-between align-items-center">
                            <div>
                                <p class="text-white">Maximum Zoom Level</p>
                                <p class="setting-description" style="font-weight: 300;">Specify the maximum amount of
                                    zoom level on Google Maps (0-22 levels) (Default is 16)</p>
                                <p class="text-danger" style="position: absolute; margin-top: 1px; display:none"
                                    id="maximum-zoom-level-warning-text">
                                    Maximum zoom
                                    level must not lower than minimum zoom
                                    level and must above or equals to initial zoom level!
                                </p>
                            </div>
                            <div class="input-group" style="width: 15%;">
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-danger"
                                        style="border-radius: 0.375rem 0rem 0rem 0.375rem"
                                        id="decreaseBtn-max-zoom-level">-</button>
                                </span>
                                <input type="number" disabled class="form-control text-light text-center"
                                    style="background-color: #313131cc; border: 1px solid #4d4d4d"
                                    id="maximum-zoom-level-input" value="0" min="0" max="22">
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-success" id="increaseBtn-max-zoom-level"
                                        style="border-radius: 0rem 0.375rem 0.375rem 0rem">+</button>
                                </span>
                            </div>
                        </div>
                        <div class="form-group d-flex flex-row justify-content-between align-items-center">
                            <div>
                                <p class="text-white">Initial Zoom Level</p>
                                <p class="setting-description" style="font-weight: 300;">Specify the initial zoom level
                                    on Google Maps (0-22 levels) (Default is 7)</p>
                                <p class="text-danger" style="position: absolute; margin-top: 1px; display:none"
                                    id="initial-zoom-level-warning-text">
                                    Initial zoom level must between specified maximum and minimum zoom level !
                                </p>
                            </div>
                            <div class="input-group" style="width: 15%;">
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-danger"
                                        style="border-radius: 0.375rem 0rem 0rem 0.375rem"
                                        id="decreaseBtn-initial-zoom-level">-</button>
                                </span>
                                <input type="number" disabled class="form-control text-light text-center"
                                    style="background-color: #313131cc; border: 1px solid #4d4d4d"
                                    id="initial-zoom-level-input" value="0" min="0" max="22">
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-success" id="increaseBtn-initial-zoom-level"
                                        style="border-radius: 0rem 0.375rem 0.375rem 0rem">+</button>
                                </span>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="my-5 d-flex flex-row justify-content-between px-5">
                    <button class="btn btn-outline-info" data-bs-toggle="modal"
                        data-bs-target="#restore-default-confirmation-modal">

                        Restore Default
                    </button>
                    <button id="save-button" class="btn btn-outline-success" disabled style="width: 150px"
                        onclick="save_setting()">Save</button>
                </div>
            </div>
        </div>
        <section class=" d-flex flex-column p-5"
            style="width: 300px;gap: 10px;border-left: 1px solid rgba(255, 255, 255, 0.397)">
            <button class="btn btn-outline-secondary" onclick="window.location.href='/app/dashboard/'">
                Statistics
            </button>
            <button class="btn btn-outline-secondary" onclick="window.location.href='/app/user/'">
                Create Users
            </button>
            <button class="btn btn-primary" onclick="window.location.href='/app/setting/'">
                Settings
            </button>
        </section>
    </section>

    <div class="modal fade" id="restore-default-confirmation-modal" tabindex="-1"
        aria-labelledby="restore-default-confirmation-modal-label" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark">
                <div class="modal-header d-flex align-items-center" style="border-bottom: 1px solid gray;">
                    <div class="modal-title text-danger d-flex align-items-center warning-container" style="gap: 6px">
                        <i class="bi bi-exclamation-triangle-fill text-info"></i>
                        <h4 class="text-info" style="margin-top: 6px;font-size:18px">Warning</h4>
                    </div>
                    <button type="button" class="btn-close btn-close-white" aria-label="Close"
                        data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p style="color: rgb(163, 163, 163);font-size: 18px;">
                        Are you sure you want to reset setting to default?
                    </p>
                    <p class="text-info" style="font-size: 17px;">
                        This cannot be undone!
                    </p>
                </div>
                <div class="modal-footer" style="border-top: 1px solid gray;">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-outline-info" data-bs-dismiss="modal"
                        onclick="restore_default()">Restore Default</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        const defaultSetting = {
            "NUM_IMAGE_THRESHOLD": 10,
            "MAP_INITIAL_ZOOM_LEVEL": 6,
            "MAP_MAXIMUM_ZOOM_LEVEL": 16,
            "MAP_MINIMUM_ZOOM_LEVEL": 7
        }
        var initialSetting = {}

        $(document).ready(() => {
            $.ajax({
                url: "/api/setting",
                type: "GET",
                contentType: "application/json",
                success: function (response) {
                    initialSetting = response
                    $('#image-threshold-input').val(initialSetting.NUM_IMAGE_THRESHOLD)
                    $('#initial-zoom-level-input').val(initialSetting.MAP_INITIAL_ZOOM_LEVEL)
                    $('#maximum-zoom-level-input').val(initialSetting.MAP_MAXIMUM_ZOOM_LEVEL)
                    $('#minimum-zoom-level-input').val(initialSetting.MAP_MINIMUM_ZOOM_LEVEL)
                },
                error: function (xhr, status, error) {
                }
            });
        })
    </script>
    <script>
        function restore_default() {
            $('#image-threshold-input').val(10)
            $('#initial-zoom-level-input').val(7)
            $('#maximum-zoom-level-input').val(16)
            $('#minimum-zoom-level-input').val(6)
            save_setting()
        }

        function setting_value_changed() {
            if (initialSetting.NUM_IMAGE_THRESHOLD == $('#image-threshold-input').val() && initialSetting.MAP_INITIAL_ZOOM_LEVEL == $('#initial-zoom-level-input').val() && initialSetting.MAP_MAXIMUM_ZOOM_LEVEL == $('#maximum-zoom-level-input').val() && initialSetting.MAP_MINIMUM_ZOOM_LEVEL == $('#minimum-zoom-level-input').val()) {
                $('#save-button').attr('disabled', true)
            } else {
                $('#save-button').attr('disabled', false)
            }
        }

        function save_setting() {
            var updated_setting = {
                "NUM_IMAGE_THRESHOLD": $('#image-threshold-input').val(),
                "MAP_INITIAL_ZOOM_LEVEL": $('#initial-zoom-level-input').val(),
                "MAP_MAXIMUM_ZOOM_LEVEL": $('#maximum-zoom-level-input').val(),
                "MAP_MINIMUM_ZOOM_LEVEL": $('#minimum-zoom-level-input').val()
            }

            $.ajax({
                url: "/api/setting",
                type: "PUT",
                contentType: "application/json",
                data: JSON.stringify(updated_setting),
                success: function (response) {
                    $('#save-button').prop('disabled', true)
                    initialSetting = updated_setting
                    $('#initial-zoom-level-warning-text').hide()
                    $('#maximum-zoom-level-warning-text').hide()
                    $('#minimum-zoom-level-warning-text').hide()
                },
                error: function (xhr, status, error) {
                }
            });
        }

        function addEventNumberInput(number_input, increase_btn, decrease_btn, maximum, minimum, val = () => { return true }) {
            increase_btn.on('click', function () {
                decrease_btn.prop("disabled", false)
                let currentValue = parseInt(number_input.val());
                if (currentValue < maximum && val()) {
                    number_input.val(currentValue + 1);
                }
                if ((currentValue + 1) == maximum) {
                    increase_btn.prop("disabled", true)
                }
                setting_value_changed()
            });

            decrease_btn.on('click', function () {
                increase_btn.prop("disabled", false)
                let currentValue = parseInt(number_input.val());
                if (currentValue > minimum && val(false)) {
                    number_input.val(currentValue - 1);
                }
                if ((currentValue - 1) == minimum) {
                    decrease_btn.prop("disabled", true)
                }
                setting_value_changed()
            });


        }
    </script>
    <script>
        $(document).ready(function () {
            addEventNumberInput($('#image-threshold-input'), $('#increaseBtn-image-threshold'), $('#decreaseBtn-image-threshold'), 100, 1)
            addEventNumberInput($('#minimum-zoom-level-input'), $('#increaseBtn-min-zoom-level'), $('#decreaseBtn-min-zoom-level'), 22, 0, limitMinZoom)
            addEventNumberInput($('#maximum-zoom-level-input'), $('#increaseBtn-max-zoom-level'), $('#decreaseBtn-max-zoom-level'), 22, 0, limitMaxZoom)
            addEventNumberInput($('#initial-zoom-level-input'), $('#increaseBtn-initial-zoom-level'), $('#decreaseBtn-initial-zoom-level'), 22, 0, limitInitialZoom)
        });

        function limitInitialZoom(add = true) {
            var minZoom = parseInt($('#minimum-zoom-level-input').val())
            var maxZoom = parseInt($('#maximum-zoom-level-input').val())
            var initZoom = parseInt($('#initial-zoom-level-input').val())
            if (add) {
                if (initZoom == (maxZoom)) {
                    $('#initial-zoom-level-warning-text').show()
                    return false
                } else {
                    $('#initial-zoom-level-warning-text').hide()
                    return true
                }
            } else {
                if (initZoom == (minZoom)) {
                    $('#initial-zoom-level-warning-text').show()
                    return false
                } else {
                    $('#initial-zoom-level-warning-text').hide()
                    return true
                }
            }
        }

        function limitMinZoom(add = true) {
            var minZoom = parseInt($('#minimum-zoom-level-input').val())
            var maxZoom = parseInt($('#maximum-zoom-level-input').val())
            var initialZoom = parseInt($('#initial-zoom-level-input').val())
            if (add) {
                if (minZoom < maxZoom - 1 && minZoom < initialZoom) {
                    return true
                } else {
                    $('#minimum-zoom-level-warning-text').show()
                    return false
                }
            } else {
                $('#minimum-zoom-level-warning-text').hide()
                return true
            }

        }

        function limitMaxZoom(add = true) {
            var minZoom = parseInt($('#minimum-zoom-level-input').val())
            var maxZoom = parseInt($('#maximum-zoom-level-input').val())
            var initialZoom = parseInt($('#initial-zoom-level-input').val())
            if (add) {
                $('#maximum-zoom-level-warning-text').hide()
                return true
            } else {
                if (maxZoom > minZoom + 1 && maxZoom > initialZoom) {
                    return true
                } else {
                    $('#maximum-zoom-level-warning-text').show()
                    return false
                }
            }

        }
    </script>
</body>

</html>