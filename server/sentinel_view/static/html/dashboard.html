<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/api/css/base.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"
        integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>SentinelVision</title>
    <link rel="icon" type="image/x-icon" href="/api/img/resource/app-icon.png">
</head>

<body class="bg-dark d-flex flex-column" style="height: 100dvh;width: 100vw;overflow-y:hidden;">
    <header class="py-3 px-5 bg-dark d-flex flex-row justify-content-between align-items-center"
        style="margin-bottom: 1px;outline: 1px solid rgba(255, 255, 255, 0.685);z-index: 9999;width:100dvw">
        <button class="d-flex flex-row align-items-center" style="gap: 10px; background-color:transparent"
            onclick="window.location.href='/app/'">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 85 85" fill="none">
                <circle cx="42.5" cy="42.5" r="42.5" fill="#E8F3F1" />
                <g clip-path="url(#clip0_1_9)">
                    <path
                        d="M43.12 47.66C42.44 48.21 42 49.05 42 50V61H56C58.2 61 60 59.2 60 57V45.05C58.11 44.38 56.09 44 54 44C49.95 44 46.13 45.4 43.12 47.66Z"
                        fill="#364B44" />
                    <path
                        d="M54 41C59.5228 41 64 36.5228 64 31C64 25.4772 59.5228 21 54 21C48.4772 21 44 25.4772 44 31C44 36.5228 48.4772 41 54 41Z"
                        fill="#00FFD0" />
                    <path
                        d="M41 31C41 28.83 41.54 26.8 42.47 25H28C25.8 25 24 26.8 24 29V57C24 58.1 24.45 59.1 25.18 59.83L44.81 40.2C42.46 37.84 41 34.59 41 31Z"
                        fill="#009BFB" />
                </g>
                <defs>
                    <clipPath id="clip0_1_9">
                        <rect width="48" height="48" fill="white" transform="translate(18 19)" />
                    </clipPath>
                </defs>
            </svg>
            <h4 class="d-none d-md-block" style="font-family: Poppins;font-weight: 400;color: #ffffff">SentinelVision
            </h4>
        </button>
        <div>
            <button class="btn btn-light" onclick="window.location.href='/app/'">
                Maps
            </button>
            <button class="btn btn-success" onclick="window.location.href='/app/dashboard/'">
                Dashboard
            </button>
            <button class="btn btn-danger" onclick="window.location.href='/app/logout'">
                <i class="bi bi-door-open-fill"></i>
            </button>
        </div>
    </header>
    <section class="d-flex d-md-none flex-grow p-5" style="gap: 10px;justify-content:space-evenly">
        <button class="btn btn-primary" style="width:100%" onclick="window.location.href='/app/dashboard/'">
            Statistics
        </button>
        <button class="btn btn-outline-secondary" style="width:100%" onclick="window.location.href='/app/user/'">
            Users
        </button>
        <button class="btn btn-outline-secondary" style="width:100%" onclick="window.location.href='/app/setting/'">
            Settings
        </button>
    </section>
    <section class="d-flex flex-row justify-content-between flex-grow-1" style="width: 100%;height: 84dvh">
        <div class="p-5" id="content-container" style="width: 1450px;margin: 0px auto; overflow-y:scroll">
            <h3 class="text-light mb-5" style="font-weight: 500">Statistics</h3>
            <div class="container-fluid" style="padding: 0px 0px 10dvh;">
                <div class="d-flex flex-row flex-wrap" style="gap: 20px">
                    <style>
                        @media (min-width: 970px) {
                            #content-container::-webkit-scrollbar {
                                display: none;
                            }
                        }

                        @media (max-width: 970px) {

                            #statistic-container-1,
                            #statistic-container-2,
                            #total-potholes-by-states {
                                min-width: 100%;
                            }

                            #statistic-container-3 {
                                gap: 20px;
                            }

                        }
                    </style>
                    <div class="col-3 mb-6" id="statistic-container-1">
                        <div class="col col-12">
                            <div class="card shadow border-0" style="background-color: #39393982;">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col">
                                            <span class="h6 font-semibold text-sm d-block mb-2">
                                                <p class="text-info">
                                                    Total Annotations
                                                </p>
                                            </span>
                                            <span id="total-annotation-text"
                                                class="h3 font-bold mb-0 text-white">0</span>
                                        </div>
                                        <div class="col-auto">
                                            <div class="icon icon-shape bg-primary text-white text-lg rounded-circle">
                                                <i class="bi bi-bookmark-fill"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-2 mb-0 text-sm">
                                        <span id="total-annotation-badge"
                                            class="badge badge-pill me-2 bg-soft-danger text-danger">
                                            <i class="bi me-1"></i>
                                            <span>0%</span>
                                        </span>
                                        <span class="text-nowrap text-xs text-secondary">Since last month</span>
                                    </div>
                                    <div class="mt-6" style="border-top: 1px solid #656565"></div>
                                    <div class="row mt-6">
                                        <div class="col">
                                            <span class="h6 font-semibold text-sm d-block mb-2">
                                                <p class="text-info">
                                                    Total Potholes
                                                </p>
                                            </span>
                                            <span id="total-potholes-text" class="h3 font-bold mb-0 text-white">0</span>
                                        </div>
                                        <div class="col-auto">
                                            <div class="icon icon-shape bg-danger text-white text-lg rounded-circle">
                                                <i class="bi bi-cone-striped"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-2 mb-0 text-sm">
                                        <span id="total-potholes-badge"
                                            class="badge badge-pill bg-soft-danger text-danger me-2">
                                            <i class="bi me-1"></i>
                                            <span>0%</span>
                                        </span>
                                        <span class="text-nowrap text-xs text-secondary">Since last month</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col col-12 mt-5">
                            <div class="card shadow border-0" style="background-color: #39393982;">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col">
                                            <span class="h6 font-semibold text-info text-sm d-block mb-3">Probability
                                                of
                                                Potholes</span>
                                            <span id="probability-pothole-text"
                                                class="h3 font-bold text-white">0%</span>
                                            <div id="probability-pothole-progress-bar" class="progress mt-3">
                                                <div class="progress-bar" role="progressbar" style="width: 0%"
                                                    aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-4" id="statistic-container-2">
                        <div class="card shadow border-0" style="background-color: #39393982;">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <span class="h6 font-semibold text-info text-sm d-block mb-3">Percent of
                                            Acknowledged Annotations</span>
                                        <span id="acknowledged-annotations-text"
                                            class="h3 font-bold text-white">0%</span>
                                        <div id="acknowledged-annotations-progress-bar" class="progress mt-3">
                                            <div class="progress-bar" role="progressbar" style="width: 0%"
                                                aria-valuenow="1" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card shadow border-0 mt-5" style="background-color: #39393982;">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <span class="h6 font-semibold text-info text-sm d-block mb-3">Distribution
                                            of
                                            Annotations</span>
                                        <div id="pie-chart-content" class="d-none" style="height: 86.9%;width: 100%">
                                            <canvas id="pie-chart-statistic"
                                                style="height: 100% !important;width: 100% Imp !important"></canvas>
                                        </div>
                                        <div id="pie-chart-message"
                                            class="d-flex justify-content-center align-items-center"
                                            style="height: 12.1rem;width: 100%">
                                            <p>Not enough data ...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card shadow border-0" style="background-color: #39393982;">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <span class="h6 font-semibold text-info text-sm d-block mb-3">Overview of
                                            Potholes Past Month</span>
                                        <div style="height: 92.1%;width: 100%">
                                            <canvas id="line-chart-statistic"
                                                style="height: 100% !important; width: 100% !important"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-5" id="statistic-container-3">
                    <div class="col-9" id="total-potholes-by-states">
                        <div class="card shadow border-0" style="background-color: #39393982;">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <span class="h6 font-semibold text-info text-sm d-block mb-3">Total Potholes
                                            by
                                            States</span>
                                        <div style="height: 92.1%;width: 100%">
                                            <canvas id="bar-chart-statistic"
                                                style="height: 100% !important; width: 100% !important"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col" style="height: fit-content;">
                        <div class="card shadow border-0" style="background-color: #39393982;">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <span class="d-block mb-3 d-flex flex-column" style="gap: 5px">
                                            <p class="h6 font-semibold text-info text-sm">Average User Image
                                                Received</p>
                                            <p class="image-processing-description"
                                                style="color: #919191;font-size: 14px;">Based on 30 days of historical
                                                data</p>
                                        </span>
                                        <div class="mb-0 d-flex" style="gap: 10px">
                                            <p id="average-user-image-received-text" class="h3 font-bold text-white">
                                                0.00</p>
                                            <p class="text-success image-processing-metric" style="align-self:flex-end">
                                                image / hour</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-6" style="border-top: 1px solid #656565"></div>
                                <div class="row mt-6">
                                    <div class="col">
                                        <span class="d-block mb-3 d-flex flex-column" style="gap: 5px">
                                            <p class="h6 font-semibold text-info text-sm">Average Image Processed
                                            </p>
                                            <p class="image-processing-description"
                                                style="color: #919191;font-size: 14px;">Based on 30 days of historical
                                                data</p>
                                        </span>
                                        <div class="mb-0 d-flex" style="gap: 10px">
                                            <p id="average-image-processed-text" class="h3 font-bold text-white">0.00
                                            </p>
                                            <p class="text-success image-processing-metric" style="align-self:flex-end">
                                                image / hour
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <section class="d-none d-md-flex flex-column p-5"
            style="width: 300px;gap: 10px;border-left: 1px solid rgba(255, 255, 255, 0.397);height: ">
            <button class="btn btn-primary" onclick="window.location.href='/app/dashboard/'">
                Statistics
            </button>
            <button class="btn btn-outline-secondary" onclick="window.location.href='/app/user/'">
                Create Users
            </button>
            <button class="btn btn-outline-secondary" onclick="window.location.href='/app/setting/'">
                Settings
            </button>
        </section>
    </section>
    <script>
        var statistic_data

        $(document).ready(() => {
            $.ajax({
                url: "/api/statistic",
                type: "GET",
                contentType: "application/json",
                success: function (response) {
                    statistic_data = response
                    populate_dashboard_fields()
                },
                error: function (xhr, status, error) {
                }
            });
        })

        function populate_dashboard_fields() {
            //
            $('#total-annotation-text').html(statistic_data['total_annotations']['number'])
            $('#total-annotation-badge span').text(`${statistic_data['total_annotations']['since_last_month']} %`)
            if (statistic_data["total_annotations"]["since_last_month"] > 0) {
                $('#total-annotation-badge').addClass("bg-soft-success text-success")
                $('#total-annotation-badge i').addClass("bi-arrow-up")
            } else {
                $('#total-annotation-badge').addClass("bg-soft-danger text-danger")
                $('#total-annotation-badge i').addClass("bi-arrow-down")
            }
            //
            $('#total-potholes-text').html(statistic_data['total_potholes']['number'])
            $('#total-potholes-badge span').text(`${statistic_data['total_potholes']['since_last_month']} %`)
            if (statistic_data["total_potholes"]["since_last_month"] > 0) {
                $('#total-potholes-badge').addClass("bg-soft-success text-success")
                $('#total-potholes-badge i').addClass("bi-arrow-up")
            } else {
                $('#total-potholes-badge').addClass("bg-soft-danger text-danger")
                $('#total-potholes-badge i').addClass("bi-arrow-down")
            }
            //
            $("#probability-pothole-text").html(`${statistic_data["prob_potholes_by_image"]}%`)
            $("#probability-pothole-progress-bar .progress-bar").css("width", `${parseFloat(statistic_data["prob_potholes_by_image"])}%`)
            if (parseInt(statistic_data["prob_potholes_by_image"]) < 20) {
                $('#probability-pothole-progress-bar .progress-bar').addClass("bg-success")
            } else if (parseInt(statistic_data["prob_potholes_by_image"]) >= 20 && parseInt(statistic_data["prob_potholes_by_image"]) < 70) {
                $('#probability-pothole-progress-bar .progress-bar').addClass("bg-warning")
            } else {
                $('#probability-pothole-progress-bar .progress-bar').addClass("bg-danger")
            }
            //
            $('#acknowledged-annotations-text').html(`${statistic_data["percent_acknowledged_annotations"]}%`)
            $("#acknowledged-annotations-progress-bar .progress-bar").css("width", `${parseFloat(statistic_data["percent_acknowledged_annotations"])}%`).attr('aria-valuenow', parseFloat(statistic_data["percent_acknowledged_annotations"]));
            if (parseInt(statistic_data["percent_acknowledged_annotations"]) < 20) {
                $('#acknowledged-annotations-progress-bar .progress-bar').addClass("bg-danger")
            } else if (parseInt(statistic_data["percent_acknowledged_annotations"]) >= 20 && parseInt(statistic_data["percent_acknowledged_annotations"]) < 70) {
                $('#acknowledged-annotations-progress-bar .progress-bar').addClass("bg-warning")
            } else {
                $('#acknowledged-annotations-progress-bar .progress-bar').addClass("bg-success")
            }
            //
            create_distribution_annotation_chart()
            //
            create_pothole_series_chart()
            //
            create_pothole_state_chart()
            //
            $("#average-user-image-received-text").html(statistic_data["average_user_image_received_by_hour"]["number"])
            //
            $("#average-image-processed-text").html(statistic_data["average_image_process_by_hour"]["number"])
        }
    </script>
    <script>
        function create_distribution_annotation_chart() {
            const distribution_annotation_control = document.getElementById('pie-chart-statistic');
            const distribution_annotation_data = {
                labels: [
                    'Acknowledged',
                    'Unacknowledged',
                ],
                datasets: [{
                    label: 'Total Annotations',
                    data: [statistic_data["total_acknowledged_annotations"], statistic_data["total_unacknowledged_annotations"]],
                    backgroundColor: [
                        'rgb(37, 250, 172)',
                        'rgb(54, 162, 235)',
                    ],
                    hoverOffset: 4,
                    borderWidth: 0
                }],
            };
            if (statistic_data["total_acknowledged_annotations"] > 0 || statistic_data["total_unacknowledged_annotations"] > 0) {
                $('#pie-chart-content').removeClass("d-none")
                $('#pie-chart-message').addClass("d-none")
                new Chart(distribution_annotation_control, {
                    type: 'pie',
                    data: distribution_annotation_data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                        },

                    },
                });
            }

        }
    </script>
    <script>
        function create_pothole_series_chart() {
            const pothole_series_control = document.getElementById('line-chart-statistic');
            const pothole_series_data = {
                labels: statistic_data["total_potholes_by_day_past_month"]["date"],
                datasets: [{
                    label: 'Total Potholes',
                    data: statistic_data["total_potholes_by_day_past_month"]["pothole"],
                    fill: true,
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }]
            };

            new Chart(pothole_series_control, {
                type: 'line',
                data: pothole_series_data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                    },

                },
            });
        }
    </script>
    <script>
        function create_pothole_state_chart() {
            const pothole_state_control = document.getElementById('bar-chart-statistic');
            const pothole_state_data = {
                labels: Object.keys(statistic_data["total_potholes_by state"]),
                datasets: [{
                    label: 'Total Potholes',
                    data: Object.values(statistic_data["total_potholes_by state"]),
                    backgroundColor: [
                        'rgba(255, 159, 64)',
                    ],
                    borderColor: [
                        'rgba(255, 159, 64)',
                    ],
                    borderWidth: 1
                }]
            };

            new Chart(pothole_state_control, {
                type: 'bar',
                data: pothole_state_data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                    },

                },
            });
        }
    </script>
</body>

</html>